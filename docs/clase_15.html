<<<<<<< HEAD
=======


>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8" />
<<<<<<< HEAD
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clase 15: Interfaces con otros lenguajes &mdash; documentación de Clases de Python - </title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/rtd_overrides.css" type="text/css" />
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
=======
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Clase 15: Interfaces con otros lenguajes &mdash; documentación de Clases de Python - </title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/rtd_overrides.css" type="text/css" />

  
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
<<<<<<< HEAD
    <script src="_static/js/theme.js"></script>
=======
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
    <link rel="search" title="Búsqueda" href="search.html" />
    <link rel="next" title="Ejercicios" href="ejercicios.html" />
    <link rel="prev" title="Clase 14: Animaciones e interactividad" href="clase_14.html" /> 
</head>

<<<<<<< HEAD
<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Clases de Python
            <img src="_static/logo.svg" class="logo" alt="Logotipo"/>
          </a>
              <div class="version">
                IB - 2022
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" />
=======
<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Clases de Python
          

          
            
            <img src="_static/logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                IB - 2022
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<<<<<<< HEAD
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Dictado de las clases</span></p>
=======

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Dictado de las clases</span></p>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="clase_00.html">Clase 0: Introducción al lenguaje Python orientado a Ingenierías y Física</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_01.html">Clase 1: Introducción al lenguaje</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_02.html">Clase 2: Tipos de datos y control</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_03.html">Clase 3: Tipos complejos y control de flujo</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_04.html">Clase 4: Funciones</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_05.html">Clase 5: Entrada y salida, decoradores, y errores</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_06.html">Clase 6: Programación Orientada a Objetos</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_07.html">Clase 7: Control de versiones y biblioteca standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_08.html">Clase 8: Introducción a Numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_09.html">Clase 9: Visualización</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_10.html">Clase 10: Más información sobre <strong>Numpy</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_11.html">Clase 11: Introducción al paquete Scipy</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html">Clase 12: Un poco de graficación 3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_13.html">Clase 13: Interpolación y ajuste de curvas (fiteo)</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_14.html">Clase 14: Animaciones e interactividad</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Clase 15: Interfaces con otros lenguajes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#interface-con-lenguaje-c">Interface con lenguaje C</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ejemplo-1-problema-a-resolver">Ejemplo 1: Problema a resolver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interfaces-con-c">Interfaces con C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#primer-ejemplo-nuestro-codigo">Primer ejemplo: Nuestro código</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ctypes">CTypes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interface-con-lenguaje-fortran">Interface con lenguaje Fortran</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Ejemplo 1: Problema a resolver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interfaces-con-fortran">Interfaces con Fortran</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">Primer ejemplo: Nuestro código</a></li>
<li class="toctree-l4"><a class="reference internal" href="#f2py">F2PY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#segundo-ejemplo-codigo-heredado">Segundo Ejemplo: Código heredado</a></li>
<li class="toctree-l4"><a class="reference internal" href="#f2py-para-codigo-en-c">F2PY para código en C</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<<<<<<< HEAD
<p class="caption" role="heading"><span class="caption-text">Ejercicios de Clase</span></p>
=======
<p class="caption"><span class="caption-text">Ejercicios de Clase</span></p>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<ul>
<li class="toctree-l1"><a class="reference internal" href="ejercicios.html">Ejercicios</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="programa_detalle.html">Programa Detallado</a></li>
</ul>

<<<<<<< HEAD
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Clases de Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Clase 15: Interfaces con otros lenguajes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/clase_15.rst.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul>
=======
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Clases de Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Clase 15: Interfaces con otros lenguajes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/clase_15.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
<<<<<<< HEAD
             
  <div class="section" id="clase-15-interfaces-con-otros-lenguajes">
<span id="clase-15"></span><h1>Clase 15: Interfaces con otros lenguajes<a class="headerlink" href="#clase-15-interfaces-con-otros-lenguajes" title="Enlazar permanentemente con este título"></a></h1>
<div class="section" id="interface-con-lenguaje-c">
<h2>Interface con lenguaje C<a class="headerlink" href="#interface-con-lenguaje-c" title="Enlazar permanentemente con este título"></a></h2>
=======
            
  <div class="section" id="clase-15-interfaces-con-otros-lenguajes">
<span id="clase-15"></span><h1>Clase 15: Interfaces con otros lenguajes<a class="headerlink" href="#clase-15-interfaces-con-otros-lenguajes" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="section" id="interface-con-lenguaje-c">
<h2>Interface con lenguaje C<a class="headerlink" href="#interface-con-lenguaje-c" title="Enlazar permanentemente con este título">¶</a></h2>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<p>Existen varias formas de utilizar bibliotecas o códigos hechos en C
desde Python. Nosotros veremos el uso de <code class="docutils literal notranslate"><span class="pre">Ctypes</span></code>, sin embargo existen
otras alternativas como <a class="reference external" href="https://cython.org/">Cython</a>,
<a class="reference external" href="https://cffi.readthedocs.io/en/latest/">CFFI</a>,
<a class="reference external" href="https://pybind11.readthedocs.io/en/stable/">pybind11</a> y
<a class="reference external" href="https://www.boost.org/doc/libs/1_70_0/libs/python/doc/html/index.html">Boost.Python</a>.</p>
<div class="section" id="ejemplo-1-problema-a-resolver">
<<<<<<< HEAD
<h3>Ejemplo 1: Problema a resolver<a class="headerlink" href="#ejemplo-1-problema-a-resolver" title="Enlazar permanentemente con este título"></a></h3>
=======
<h3>Ejemplo 1: Problema a resolver<a class="headerlink" href="#ejemplo-1-problema-a-resolver" title="Enlazar permanentemente con este título">¶</a></h3>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<p>Supongamos que queremos resolver el problema de la rotación de vectores
en el espacio usando los tres ángulos de Euler.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pwd</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/Users/flavioc/Library/Mobile Documents/com~apple~CloudDocs/Documents/cursos/curso-python&#39;</span>
</pre></div>
</div>
<p>Si ya tenemos un módulo donde están programadas las funciones necesarias</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load rotacion_p.py</span>
<span class="c1">#! /usr/bin/ipython3</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
  <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
  <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
  <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">sy</span>

  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sy</span>

  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cy</span>
  <span class="k">return</span> <span class="n">R</span>


<span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<p>es fácil utilizarlas. Las importamos y utilizamos</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import rotacion_p as rotp</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># Ángulos de Euler</span>
<span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Definimos N vectores tridimensionales</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># y= rotp.rotate(angle, v)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.50865471</span> <span class="mf">0.8181404</span>  <span class="mf">0.53468601</span><span class="p">]</span>
<span class="p">[[</span> <span class="mf">1.14137158</span> <span class="o">-</span><span class="mf">0.09559654</span> <span class="o">-</span><span class="mf">0.105005</span>  <span class="p">]</span>
 <span class="p">[</span> <span class="mf">1.00659971</span> <span class="o">-</span><span class="mf">0.09141267</span> <span class="o">-</span><span class="mf">0.14818529</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.96071663</span> <span class="o">-</span><span class="mf">0.39351893</span>  <span class="mf">0.09300136</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.98322967</span> <span class="o">-</span><span class="mf">0.12991836</span> <span class="o">-</span><span class="mf">0.05407704</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.75230624</span>  <span class="mf">0.10485721</span>  <span class="mf">0.80743319</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="section" id="interfaces-con-c">
<<<<<<< HEAD
<h3>Interfaces con C<a class="headerlink" href="#interfaces-con-c" title="Enlazar permanentemente con este título"></a></h3>
<p>Veamos cómo trabajar si tenemos el código para realizar las rotaciones
en C.</p>
<div class="section" id="primer-ejemplo-nuestro-codigo">
<h4>Primer ejemplo: Nuestro código<a class="headerlink" href="#primer-ejemplo-nuestro-codigo" title="Enlazar permanentemente con este título"></a></h4>
=======
<h3>Interfaces con C<a class="headerlink" href="#interfaces-con-c" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Veamos cómo trabajar si tenemos el código para realizar las rotaciones
en C.</p>
<div class="section" id="primer-ejemplo-nuestro-codigo">
<h4>Primer ejemplo: Nuestro código<a class="headerlink" href="#primer-ejemplo-nuestro-codigo" title="Enlazar permanentemente con este título">¶</a></h4>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<p>El código en C que tenemos es:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span> <span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
      <span class="kt">float</span> <span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
    <span class="p">}</span> <span class="n">m3x3</span><span class="p">;</span>

    <span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
      <span class="kt">float</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="p">}</span> <span class="n">v3</span><span class="p">;</span>

<span class="p">...</span>

<span class="kt">float</span> <span class="o">*</span> <span class="n">rotate</span><span class="p">(</span><span class="kt">float</span> <span class="n">angles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">){</span>

        <span class="n">m3x3</span> <span class="n">R</span> <span class="o">=</span> <span class="n">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">);</span>

        <span class="kt">float</span><span class="o">*</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
        <span class="n">v3</span> <span class="n">p</span><span class="p">;</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="c1">// p = &amp;y[i*3];</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">matmul3</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">]);</span>
            <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
            <span class="c1">// printf(&quot;%6.3f %6.3f %6.3f \n&quot;,y[i*3+0],y[i*3+1],y[i*3+2]);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">;</span>


  <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">interfacing_C</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">flavioc</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">Mobile</span> <span class="n">Documents</span><span class="o">/</span><span class="n">com</span><span class="o">~</span><span class="n">apple</span><span class="o">~</span><span class="n">CloudDocs</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">cursos</span><span class="o">/</span><span class="n">curso</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="n">interfacing_C</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!cat rotacion.c
</pre></div>
</div>
<pre class="literal-block">#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;
#include&lt;math.h&gt;


    typedef struct {
      float m[3][3];
    } m3x3;

    typedef struct {
      float a[3];
    } v3;

  // !&gt; matrix_rotation
  // !! Crea la matriz de rotación correspondiente a los tres ángulos de Euler
  // !!
  // !! &#64;param angles
  // !! &#64;return R

    m3x3 matrix_rotation(float angles[3]){

        m3x3 R;

        float cx = cos(angles[0]);
        float cy = cos(angles[1]);
        float cz = cos(angles[2]);
        float sx = sin(angles[0]);
        float sy = sin(angles[1]);
        float sz = sin(angles[2]);


        R.m[0][0] = cx*cz - sx*cy*sz;
        R.m[0][1] = cx*sz + sx*cy*cz;
        R.m[0][2] = sx*sy;

        R.m[1][0] = -sx*cz - cx*cy*sz;
        R.m[1][1] = -sx*sz + cx*cy*cz;
        R.m[1][2] = cx*sy;

        R.m[2][0] = sy*sz;
        R.m[2][1] = -sy*cz;
        R.m[2][2] = cy;

        return R;
  }

  v3 matmul3(m3x3 A, float b[3]){

      static v3 a;

      for(int i=0; i &lt; 3; i++){
            a.a[0] = A.m[0][0] * b[0] + A.m[0][1] * b[1] + A.m[0][2] * b[2];
            a.a[1] = A.m[1][0] * b[0] + A.m[1][1] * b[1] + A.m[1][2] * b[2];
            a.a[2] = A.m[2][0] * b[0] + A.m[2][1] * b[1] + A.m[2][2] * b[2];
          }
    //  printf(&quot;%6.3f %6.3f %6.3f n&quot;,a[0],a[1],a[2]);

      return a;
  }



    float * rotate(float angles[3], float <em>v, int N){

        m3x3 R = matrix_rotation(angles);


        float</em> y = (float*)malloc(3*N*sizeof(float));
        v3 p;

        printf(&quot;%pn&quot;,y);
        for(int i=0; i&lt;N; i++){
            // p = &amp;y[i*3];
            p = matmul3(R,&amp;v[i*3]);
            y[i*3+0] = p.a[0];
            y[i*3+1] = p.a[1];
            y[i*3+2] = p.a[2];
            // printf(&quot;%6.3f %6.3f %6.3f n&quot;,y[i*3+0],y[i*3+1],y[i*3+2]);
        }
        return y;


  }


int main(){

  float angle[3] = { 0.0f, 0.0f, 3.141592f/2.0f};

  m3x3 R;

  int NDIM = 2;
  float* v = (float*)malloc(3*NDIM*sizeof(float));

  float <a href="#id1"><span class="problematic" id="id2">*</span></a>y;

  for (size_t j = 0; j &lt; NDIM; j++)
      {
            v[j*3+0] = (j*3+0)*1.0f;
            v[j*3+1] = (j*3+1)*1.0f;
            v[j*3+2] = (j*3+2)*1.0f;
      }

  v[0] = (1)*1.0f;
  v[1] = (0)*1.0f;
  v[2] = (0)*1.0f;
  v[3] = (0)*1.0f;
  v[4] = (1)*1.0f;
  v[5] = (0)*1.0f;



  R = matrix_rotation(angle);

    for(int i = 0; i &lt; 3; i++){
        for(int j = 0; j &lt; 3; j++){
            printf(&quot;%6.3f&quot;,R.m[i][j]);
            printf(&quot;   &quot;);
        }
        printf(&quot;n&quot;);
    }

  y = rotate(angle,v,NDIM);
  printf(&quot;%6.3f %6.3f %6.3f n&quot;,y[0],y[1],y[2]);
  printf(&quot;%6.3f %6.3f %6.3f n&quot;,y[3],y[4],y[5]);
  // for (size_t i = 0; i &lt; NDIM; i++)
  // {
  //    printf(&quot;%6.3f %6.3f %6.3f n&quot;,y[i*3],y[i*3+1],y[i*3+2]);
  // }


}</pre>
</div>
<div class="section" id="ctypes">
<<<<<<< HEAD
<h4>CTypes<a class="headerlink" href="#ctypes" title="Enlazar permanentemente con este título"></a></h4>
=======
<h4>CTypes<a class="headerlink" href="#ctypes" title="Enlazar permanentemente con este título">¶</a></h4>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<p>No vamos a usar directamente <code class="docutils literal notranslate"><span class="pre">Ctypes</span></code>, sino a través de <code class="docutils literal notranslate"><span class="pre">NumPy</span></code>, que
provee algunas funciones convenientes para acceder al código C.</p>
<p>El primer paso es compilar nuestro código y generar una biblioteca:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gcc -fpic -Wall -shared rotacion.c -o librotacion.so
</pre></div>
</div>
<p>Si uno trabaja en Windows, generará una dll</p>
<div class="highlight-cmd notranslate"><div class="highlight"><pre><span></span>cl.exe -c rotacion.c
link.exe /DLL /OUT:rotacion.dll
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!gcc -fpic -Wall -shared rotacion.c -o librotacion.so
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!ls
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[31mlibrotacion.so[m[m rotacion.c
</pre></div>
</div>
<p>En segundo lugar, importamos el módulo <code class="docutils literal notranslate"><span class="pre">ctypeslib</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy.ctypeslib</span> <span class="k">as</span> <span class="nn">ctl</span>
</pre></div>
</div>
<p>Este módulo nos provee de la función <code class="docutils literal notranslate"><span class="pre">load_library</span></code> para importar la
biblioteca</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">ctl</span><span class="o">.</span><span class="n">load_library</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Help</span> <span class="n">on</span> <span class="n">function</span> <span class="n">load_library</span> <span class="ow">in</span> <span class="n">module</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ctypeslib</span><span class="p">:</span>

<span class="n">load_library</span><span class="p">(</span><span class="n">libname</span><span class="p">,</span> <span class="n">loader_path</span><span class="p">)</span>
    <span class="n">It</span> <span class="ow">is</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">load</span> <span class="n">a</span> <span class="n">library</span> <span class="n">using</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">cdll</span><span class="p">[</span><span class="o">&lt;</span><span class="n">full_path_name</span><span class="o">&gt;</span><span class="p">]</span> <span class="c1"># doctest: +SKIP</span>

    <span class="n">But</span> <span class="n">there</span> <span class="n">are</span> <span class="n">cross</span><span class="o">-</span><span class="n">platform</span> <span class="n">considerations</span><span class="p">,</span> <span class="n">such</span> <span class="k">as</span> <span class="n">library</span> <span class="n">file</span> <span class="n">extensions</span><span class="p">,</span>
    <span class="n">plus</span> <span class="n">the</span> <span class="n">fact</span> <span class="n">Windows</span> <span class="n">will</span> <span class="n">just</span> <span class="n">load</span> <span class="n">the</span> <span class="n">first</span> <span class="n">library</span> <span class="n">it</span> <span class="n">finds</span> <span class="k">with</span> <span class="n">that</span> <span class="n">name</span><span class="o">.</span>
    <span class="n">NumPy</span> <span class="n">supplies</span> <span class="n">the</span> <span class="n">load_library</span> <span class="n">function</span> <span class="k">as</span> <span class="n">a</span> <span class="n">convenience</span><span class="o">.</span>

    <span class="n">Parameters</span>
    <span class="o">----------</span>
    <span class="n">libname</span> <span class="p">:</span> <span class="nb">str</span>
        <span class="n">Name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">library</span><span class="p">,</span> <span class="n">which</span> <span class="n">can</span> <span class="n">have</span> <span class="s1">&#39;lib&#39;</span> <span class="k">as</span> <span class="n">a</span> <span class="n">prefix</span><span class="p">,</span>
        <span class="n">but</span> <span class="n">without</span> <span class="n">an</span> <span class="n">extension</span><span class="o">.</span>
    <span class="n">loader_path</span> <span class="p">:</span> <span class="nb">str</span>
        <span class="n">Where</span> <span class="n">the</span> <span class="n">library</span> <span class="n">can</span> <span class="n">be</span> <span class="n">found</span><span class="o">.</span>

    <span class="n">Returns</span>
    <span class="o">-------</span>
    <span class="n">ctypes</span><span class="o">.</span><span class="n">cdll</span><span class="p">[</span><span class="n">libpath</span><span class="p">]</span> <span class="p">:</span> <span class="n">library</span> <span class="nb">object</span>
       <span class="n">A</span> <span class="n">ctypes</span> <span class="n">library</span> <span class="nb">object</span>

    <span class="n">Raises</span>
    <span class="o">------</span>
    <span class="ne">OSError</span>
        <span class="n">If</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">library</span> <span class="k">with</span> <span class="n">the</span> <span class="n">expected</span> <span class="n">extension</span><span class="p">,</span> <span class="ow">or</span> <span class="n">the</span>
        <span class="n">library</span> <span class="ow">is</span> <span class="n">defective</span> <span class="ow">and</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">loaded</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rotc</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="n">load_library</span><span class="p">(</span><span class="s1">&#39;librotacion.so&#39;</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Una vez cargada la biblioteca, tenemos que definir adecuadamente cómo
pasar los argumentos a la función <code class="docutils literal notranslate"><span class="pre">rotate</span></code> de C:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span> <span class="o">*</span> <span class="n">rotate</span><span class="p">(</span><span class="kt">float</span> <span class="n">angles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>Para eso se utiliza la función <code class="docutils literal notranslate"><span class="pre">argtypes</span></code> que recibe una lista de
tipos. Notemos que los dos primeros argumentos son arreglos de C (o sea,
punteros), mientras que el último es un entero.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">npflags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C_CONTIGUOUS&#39;</span><span class="p">]</span>   <span class="c1"># Require a C contiguous array in memory</span>

<span class="n">float_1d_type</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">npflags</span><span class="p">)</span> <span class="c1"># Puntero a float, 1D</span>
<span class="n">float_2d_type</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">npflags</span><span class="p">)</span> <span class="c1"># Puntero a float, 2D</span>
</pre></div>
</div>
<p>Con estos tipos de datos, defino los tipos de argumentos, que son tres
en total. El último es un dato de tipo entero, para lo cual se usa
directamente <code class="docutils literal notranslate"><span class="pre">c_intp</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rotc</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span>  <span class="p">[</span><span class="n">float_1d_type</span><span class="p">,</span> <span class="n">float_2d_type</span><span class="p">,</span> <span class="n">ctl</span><span class="o">.</span><span class="n">c_intp</span><span class="p">]</span>
</pre></div>
</div>
<p>Hagamos un ejemplo sencillo con N=2</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import rotacion_p as rotp</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># Ángulos de Euler</span>
<span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="c1"># Definimos N vectores tridimensionales</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<p>Las funciones que dispongo en C reciben tipos <code class="docutils literal notranslate"><span class="pre">float</span></code>, es decir que me
tengo que asegurar esto a través del método <code class="docutils literal notranslate"><span class="pre">astype</span></code>.</p>
<p>Ahora tenemos que definir el tipo de dato de salida, que retorna C a
través de un puntero a float, <code class="docutils literal notranslate"><span class="pre">float*</span></code>. Para esto usamos el método
<code class="docutils literal notranslate"><span class="pre">restype</span></code>. Como a priori no sé qué tipo de rango tiene mi arreglo de
salida, tengo que definirlo explícitamente.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rotc</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>Hay que tener precaución con el manejo de arreglos, que es muy distinto
en C y Python. En Python son objetos, de los cuales yo puedo tener
distintas vistas, slices, etc. Hay que recordar que en principio estas
son formas de acceder al mismo objeto, pero no se pueden traducir
directamente a C, que necesita un arreglo contiguo de datos.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">vt</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Veamos, v es un arreglo de 3 filas y 2 columnas, que contiene <em>dos</em>
vectores de tres dimensiones que se desean rotar, organizados como
columnas. Esto <em>no</em> es lo que necesita mi arreglo en C, que es tiene los
vectores organizados contiguamente en un solo arreglo unidimensional.
Entonces, tengo que transformarlo. Para eso usamos el <code class="docutils literal notranslate"><span class="pre">.T</span></code>. Ojo que
además, hay que crear un objeto nuevo con <code class="docutils literal notranslate"><span class="pre">copy()</span></code>, sino es una vista
del mismo objeto <code class="docutils literal notranslate"><span class="pre">v</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">angle90</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">angle90</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.</span>        <span class="mf">0.</span>        <span class="mf">1.5707964</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yf</span> <span class="o">=</span> <span class="n">rotc</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle90</span><span class="p">,</span>
                      <span class="n">vt</span><span class="p">,</span>
                      <span class="n">N</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">angle90</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">yf</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">yf</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="o">-</span><span class="mf">0.00000004</span>  <span class="mf">1.</span>        <span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">1.</span>         <span class="o">-</span><span class="mf">0.00000004</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.</span>          <span class="mf">0.</span>        <span class="p">]]</span>
<span class="p">[[</span><span class="o">-</span><span class="mf">0.00000004</span>  <span class="mf">1.</span>        <span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">1.</span>         <span class="o">-</span><span class="mf">0.00000004</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.</span>          <span class="mf">0.</span>        <span class="p">]]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="interface-con-lenguaje-fortran">
<<<<<<< HEAD
<h2>Interface con lenguaje Fortran<a class="headerlink" href="#interface-con-lenguaje-fortran" title="Enlazar permanentemente con este título"></a></h2>
<div class="section" id="id3">
<h3>Ejemplo 1: Problema a resolver<a class="headerlink" href="#id3" title="Enlazar permanentemente con este título"></a></h3>
=======
<h2>Interface con lenguaje Fortran<a class="headerlink" href="#interface-con-lenguaje-fortran" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="id3">
<h3>Ejemplo 1: Problema a resolver<a class="headerlink" href="#id3" title="Enlazar permanentemente con este título">¶</a></h3>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<p>Supongamos que queremos resolver el problema de la rotación de vectores
en el espacio usando los tres ángulos de Euler.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pwd</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/Users/flavioc/Library/Mobile Documents/com~apple~CloudDocs/Documents/cursos/curso-python&#39;</span>
</pre></div>
</div>
<p>Si ya tenemos un módulo donde están programadas las funciones necesarias</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load rotacion_p.py</span>
<span class="c1">#! /usr/bin/ipython3</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
  <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
  <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
  <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">sy</span>

  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sy</span>

  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cy</span>
  <span class="k">return</span> <span class="n">R</span>


<span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<p>es fácil utilizarlas. Las importamos y utilizamos</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import rotacion_p as rotp</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># Ángulos de Euler</span>
<span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Definimos N vectores tridimensionales</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># y= rotp.rotate(angle, v)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.36341885</span> <span class="mf">0.58028317</span> <span class="mf">0.4486011</span> <span class="p">]</span>
<span class="p">[[</span> <span class="mf">4.22770593e-01</span>  <span class="mf">3.33318934e-01</span> <span class="o">-</span><span class="mf">5.49571740e-04</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">6.05335674e-01</span>  <span class="mf">4.34396149e-01</span>  <span class="mf">6.87862512e-01</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">9.84128217e-01</span>  <span class="mf">4.35323746e-01</span> <span class="o">-</span><span class="mf">1.62964229e-01</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">3.17757248e-01</span>  <span class="mf">4.72584037e-01</span>  <span class="mf">3.75531685e-01</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">7.35722302e-01</span>  <span class="mf">1.58547744e-01</span>  <span class="mf">6.73141163e-01</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="section" id="interfaces-con-fortran">
<<<<<<< HEAD
<h3>Interfaces con Fortran<a class="headerlink" href="#interfaces-con-fortran" title="Enlazar permanentemente con este título"></a></h3>
<p>Veamos cómo trabajar si tenemos el código para realizar las rotaciones
en Fortran</p>
<div class="section" id="id4">
<h4>Primer ejemplo: Nuestro código<a class="headerlink" href="#id4" title="Enlazar permanentemente con este título"></a></h4>
=======
<h3>Interfaces con Fortran<a class="headerlink" href="#interfaces-con-fortran" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Veamos cómo trabajar si tenemos el código para realizar las rotaciones
en Fortran</p>
<div class="section" id="id4">
<h4>Primer ejemplo: Nuestro código<a class="headerlink" href="#id4" title="Enlazar permanentemente con este título">¶</a></h4>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<p>El código en Fortran que tenemos es:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">function </span><span class="n">rotate</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">N</span>
  <span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
  <span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">v</span>
  <span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="kd">::</span> <span class="n">y</span>
  <span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">R</span>
  <span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cz</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span>

  <span class="c">! Senos y Cosenos de los tres ángulos de Euler</span>
  <span class="n">cx</span> <span class="o">=</span> <span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span> <span class="n">cy</span> <span class="o">=</span> <span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span> <span class="n">cz</span> <span class="o">=</span> <span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
  <span class="n">sx</span> <span class="o">=</span> <span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span> <span class="n">sy</span> <span class="o">=</span> <span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span> <span class="n">sz</span> <span class="o">=</span> <span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

  <span class="c">! Matriz de rotación</span>
  <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">cx</span><span class="o">*</span><span class="n">cz</span> <span class="o">-</span> <span class="n">sx</span><span class="o">*</span><span class="n">cy</span><span class="o">*</span><span class="n">sz</span>
  <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">cx</span><span class="o">*</span><span class="n">sz</span> <span class="o">+</span> <span class="n">sx</span><span class="o">*</span><span class="n">cy</span><span class="o">*</span><span class="n">cz</span>
  <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">sx</span><span class="o">*</span><span class="n">sy</span>

  <span class="n">R</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span><span class="o">*</span><span class="n">cz</span> <span class="o">-</span> <span class="n">cx</span><span class="o">*</span><span class="n">cy</span><span class="o">*</span><span class="n">sz</span>
  <span class="n">R</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span><span class="o">*</span><span class="n">sz</span> <span class="o">+</span> <span class="n">cx</span><span class="o">*</span><span class="n">cy</span><span class="o">*</span><span class="n">cz</span>
  <span class="n">R</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cx</span><span class="o">*</span><span class="n">sy</span>

  <span class="n">R</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sy</span><span class="o">*</span><span class="n">sz</span>
  <span class="n">R</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sy</span><span class="o">*</span><span class="n">cz</span>
  <span class="n">R</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cy</span>

  <span class="c">! Aplicamos la rotación</span>
  <span class="n">y</span> <span class="o">=</span> <span class="nb">matmul</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="k">end function </span><span class="n">rotate</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">interfacing_F</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">flavioc</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">Mobile</span> <span class="n">Documents</span><span class="o">/</span><span class="n">com</span><span class="o">~</span><span class="n">apple</span><span class="o">~</span><span class="n">CloudDocs</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">cursos</span><span class="o">/</span><span class="n">curso</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="n">interfacing_F</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>cd interfacing_F
!cat rotacion.f90
</pre></div>
</div>
<pre class="literal-block">module rotaciones

contains
  !&gt; matrix_rotation
  !! Crea la matriz de rotación correspondiente a los tres ángulos de Euler
  !!
  !! &#64;param angles
  !! &#64;return R
  function matrix_rotation(angles) result(R)
    implicit none
    real(8), dimension(3), intent(IN) :: angles
    real(8), dimension(3,3) :: R
    real(8) :: cx, cy, cz, sx, sy, sz

    cx = cos(angles(1)); cy = cos(angles(2)); cz = cos(angles(3))
    sx = sin(angles(1)); sy = sin(angles(2)); sz = sin(angles(3))

    R(1,1) = cx*cz - sx*cy*sz
    R(1,2) = cx*sz + sx*cy*cz
    R(1,3) = sx*sy

    R(2,1) = -sx*cz - cx*cy*sz
    R(2,2) = -sx*sz + cx*cy*cz
    R(2,3) = cx*sy

    R(3,1) = sy*sz
    R(3,2) = -sy*cz
    R(3,3) = cy
  end function matrix_rotation

  !&gt; rotate
  !!
  !! &#64;param angles
  !! &#64;param v
  !! &#64;param N longitud del vector v
  !! &#64;return y
  function rotate(angles, v, N) result(y)
    implicit none
    integer, intent(IN) :: N
    real(8), dimension(3), intent(IN) :: angles
    real(8), dimension(3,N), intent(IN) :: v
    real(8), dimension(3,N) :: y

    y = matmul(matrix_rotation(angles), v)
  end function rotate

end module rotaciones

program test_rotation
  USE rotaciones !, only: rotate
  implicit none
  integer, parameter :: Ndim=1000
  real(8), dimension(3) :: angle
  real(8), dimension(3, Ndim) :: v, y

  integer :: n, Nloops,i,j
  real(8) :: time_begin, time_end

  real(8), dimension(3, 3) :: R


  ! Selecciono Ndim vectores tridimensionales al azar
  call RANDOM_NUMBER(v)
  Nloops = 10000

  CALL CPU_TIME ( time_begin )
  do n=1,Nloops
    call RANDOM_NUMBER(angle)
    y= rotate(angle, v, Ndim)
  end do
  CALL CPU_TIME ( time_end )

  write (<em>,'(A,1PE12.2,A)') '# Tiempo usado:', (time_end - time_begin)/(1.e-3*Nloops), ' milisegundos por 1000 rotaciones'

  ! Test a simple case

  ! angle(1) = 1.0
  ! angle(2) = 2.0
  ! angle(3) = 3.0

  ! R = matrix_rotation(angle)
  ! ! do i=1,3
  ! !  write(</em>,'(3F8.3)') R(i,1),R(i,2),R(i,3)
  ! ! end do

  ! do j=0,4
  !     v(1,j+1) = j*3+0
  !     v(2,j+1) = j*3+1
  !     v(3,j+1) = j*3+2
  ! end do
  ! y= rotate(angle, v, 5)

  ! do i=1,5
  !   write(<a href="#id5"><span class="problematic" id="id6">*</span></a>,'(3F8.3)') y(1,i),y(2,i),y(3,i)
  ! end do

end program test_rotation</pre>
</div>
<div class="section" id="f2py">
<<<<<<< HEAD
<h4>F2PY<a class="headerlink" href="#f2py" title="Enlazar permanentemente con este título"></a></h4>
=======
<h4>F2PY<a class="headerlink" href="#f2py" title="Enlazar permanentemente con este título">¶</a></h4>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<p>F2PY -Fortran to Python interface generator- es una utilidad que permite
generar una interface para utilizar funciones y datos definidos en
Fortran desde Python.</p>
<p>Información sobre la interfaz entre Fotran y Python, y en particular
sobre F2PY, puede encontrarse en:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://scipy-cookbook.readthedocs.io/items/idx_interfacing_with_other_languages.html">Scipy
cookbook</a></p></li>
<li><p><a class="reference external" href="https://docs.scipy.org/doc/numpy-dev/f2py/index.html">F2PY Users Guide and Reference
Manual</a></p></li>
<li><p><a class="reference external" href="http://www.fortran90.org/src/best-practices.html#interfacing-with-python">Fortran Best
Practices</a></p></li>
<li><p><a class="reference external" href="http://websrv.cs.umt.edu/isis/index.php/F2py_example">http://websrv.cs.umt.edu/isis/index.php/F2py_example</a></p></li>
</ul>
<p>El primer paso es utilizar esta utilidad:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ f2py3 -c rotacion.f90 -m rotacion_f
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">interfacing_F</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">flavioc</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">Mobile</span> <span class="n">Documents</span><span class="o">/</span><span class="n">com</span><span class="o">~</span><span class="n">apple</span><span class="o">~</span><span class="n">CloudDocs</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">cursos</span><span class="o">/</span><span class="n">curso</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="n">interfacing_F</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!f2py3 -c rotacion.f90 -m rotacion_f
</pre></div>
</div>
<pre class="literal-block">[39mrunning build[0m
[39mrunning config_cc[0m
[39munifing config_cc, config, build_clib, build_ext, build commands --compiler options[0m
[39mrunning config_fc[0m
[39munifing config_fc, config, build_clib, build_ext, build commands --fcompiler options[0m
[39mrunning build_src[0m
[39mbuild_src[0m
[39mbuilding extension &quot;rotacion_f&quot; sources[0m
[39mf2py options: [][0m
[39mf2py:&gt; /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/rotacion_fmodule.c[0m
[39mcreating /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9[0m
Reading fortran codes...
    Reading file 'rotacion.f90' (format:free)
Post-processing...
    Block: rotacion_f
                    Block: rotaciones
                            Block: matrix_rotation
appenddecl: &quot;dimension&quot; not implemented.
                            Block: rotate
appenddecl: &quot;dimension&quot; not implemented.
                    Block: test_rotation
Post-processing (stage 2)...
    Block: rotacion_f
            Block: unknown_interface
                    Block: rotaciones
                            Block: matrix_rotation
                            Block: rotate
                    Block: test_rotation
Building modules...
    Building module &quot;rotacion_f&quot;...
            Constructing F90 module support for &quot;rotaciones&quot;...
            Creating wrapper for Fortran function &quot;matrix_rotation&quot;(&quot;matrix_rotation&quot;)...
                    Constructing wrapper function &quot;rotaciones.matrix_rotation&quot;...
                      r = matrix_rotation(angles)
            Creating wrapper for Fortran function &quot;rotate&quot;(&quot;rotate&quot;)...
                    Constructing wrapper function &quot;rotaciones.rotate&quot;...
                      y = rotate(angles,v,[n])
    Wrote C/API module &quot;rotacion_f&quot; to file &quot;/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/rotacion_fmodule.c&quot;
    Fortran 90 wrappers are saved to &quot;/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/rotacion_f-f2pywrappers2.f90&quot;
[39m  adding '/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/fortranobject.c' to sources.[0m
[39m  adding '/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9' to include_dirs.[0m
[39mcopying /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/f2py/src/fortranobject.c -&gt; /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9[0m
[39mcopying /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/f2py/src/fortranobject.h -&gt; /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9[0m
[39m  adding '/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/rotacion_f-f2pywrappers2.f90' to sources.[0m
[39mbuild_src: building npy-pkg config files[0m
[39mrunning build_ext[0m
[39mcustomize UnixCCompiler[0m
[39mcustomize UnixCCompiler using build_ext[0m
[39mget_default_fcompiler: matching types: '['gnu95', 'nag', 'absoft', 'ibm', 'intel', 'gnu', 'g95', 'pg']'[0m
[39mcustomize Gnu95FCompiler[0m
[39mFound executable /usr/local/bin/gfortran[0m
[39mcustomize Gnu95FCompiler[0m
[39mcustomize Gnu95FCompiler using build_ext[0m
[39mbuilding 'rotacion_f' extension[0m
[39mcompiling C sources[0m
[39mC compiler: clang -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -fwrapv -O2 -Wall -fPIC -O2 -isystem /Users/flavioc/miniconda3/include -arch x86_64 -I/Users/flavioc/miniconda3/include -fPIC -O2 -isystem /Users/flavioc/miniconda3/include -arch x86_64
[0m
[39mcreating /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/var[0m
[39mcreating /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/var/folders[0m
[39mcreating /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/var/folders/18[0m
[39mcreating /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn[0m
[39mcreating /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T[0m
[39mcreating /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl[0m
[39mcreating /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9[0m
[39mcompile options: '-DNPY_DISABLE_OPTIMIZATION=1 -I/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9 -I/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include -I/Users/flavioc/miniconda3/include/python3.9 -c'[0m
[39mclang: /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/fortranobject.c[0m
[39mclang: /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/rotacion_fmodule.c[0m
In file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/rotacion_fmodule.c:16:
In file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/fortranobject.h:13:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/arrayobject.hIn file included from :/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/fortranobject.c4::
2In file included from :
/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarrayobject.hIn file included from :/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/fortranobject.h12::
13In file included from :
/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarraytypes.hIn file included from :/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/arrayobject.h1969::
4[1m:
/Users/flavIn file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarrayobject.h:12:
ioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.hIn file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarraytypes.h:1969:
[1m:17:2/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h: :[0m17[0;1;35m:warning2: :[0m [1m[0m&quot;Using deprecated NumPy API, disable it with &quot;          &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [-W#warnings][0;1;35m[0mwarning
: [0m[1m&quot;Using deprecated NumPy API, disable it with &quot;          &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [-W#warnings][0m
#warning &quot;Using deprecated NumPy API, disable it with &quot; [0;1;32m ^
[0m#warning &quot;Using deprecated NumPy API, disable it with &quot; [0;1;32m ^
[0m[1m/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/rotacion_fmodule.c:109:12: [0m[0;1;35mwarning: [0m[1munused function 'f2py_size' [-Wunused-function][0m
static int f2py_size(PyArrayObject* var, ...)
[0;1;32m           ^
[0m2 warnings generated.
1 warning generated.
[39mcompiling Fortran 90 module sources[0m
[39mFortran f77 compiler: /usr/local/bin/gfortran -Wall -g -ffixed-form -fno-second-underscore -arch x86_64 -fPIC -O3 -funroll-loops
Fortran f90 compiler: /usr/local/bin/gfortran -Wall -g -fno-second-underscore -arch x86_64 -fPIC -O3 -funroll-loops
Fortran fix compiler: /usr/local/bin/gfortran -Wall -g -ffixed-form -fno-second-underscore -Wall -g -fno-second-underscore -arch x86_64 -fPIC -O3 -funroll-loops[0m
[39mcompile options: '-I/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9 -I/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include -I/Users/flavioc/miniconda3/include/python3.9 -c'
extra options: '-J/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/ -I/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/'[0m
[39mgfortran:f90: rotacion.f90[0m
[01m[Krotacion.f90:56:24:[m[K

   56 |   integer :: n, Nloops,i,j
      |                        [01;35m[K1[m[K
[01;35m[KWarning:[m[K Unused variable '[01m[Ki[m[K' declared at [01;35m[K(1)[m[K [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wunused-variable-Wunused-variable]8;;[m[K]
[01m[Krotacion.f90:56:26:[m[K

   56 |   integer :: n, Nloops,i,j
      |                          [01;35m[K1[m[K
[01;35m[KWarning:[m[K Unused variable '[01m[Kj[m[K' declared at [01;35m[K(1)[m[K [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wunused-variable-Wunused-variable]8;;[m[K]
[01m[Krotacion.f90:59:31:[m[K

   59 |   real(8), dimension(3, 3) :: R
      |                               [01;35m[K1[m[K
[01;35m[KWarning:[m[K Unused variable '[01m[Kr[m[K' declared at [01;35m[K(1)[m[K [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wunused-variable-Wunused-variable]8;;[m[K]
[01m[Krotacion.f90:44:0:[m[K

   44 |     y = matmul(matrix_rotation(angles), v)
      |
[01;35m[KWarning:[m[K '[01m[K__var_1_mma.offset[m[K' is used uninitialized in this function [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wuninitialized-Wuninitialized]8;;[m[K]
[01m[Krotacion.f90:44:0:[m[K [01;35m[KWarning:[m[K '[01m[K__var_1_mma.dim[0].lbound[m[K' is used uninitialized in this function [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wuninitialized-Wuninitialized]8;;[m[K]
[01m[Krotacion.f90:44:0:[m[K [01;35m[KWarning:[m[K '[01m[K__var_1_mma.dim[0].ubound[m[K' is used uninitialized in this function [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wuninitialized-Wuninitialized]8;;[m[K]
[01m[Krotacion.f90:44:0:[m[K [01;35m[KWarning:[m[K '[01m[K__var_1_mma.dim[1].lbound[m[K' is used uninitialized in this function [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wuninitialized-Wuninitialized]8;;[m[K]
[01m[Krotacion.f90:44:0:[m[K [01;35m[KWarning:[m[K '[01m[K__var_1_mma.dim[1].ubound[m[K' is used uninitialized in this function [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wuninitialized-Wuninitialized]8;;[m[K]
[39mcompiling Fortran sources[0m
[39mFortran f77 compiler: /usr/local/bin/gfortran -Wall -g -ffixed-form -fno-second-underscore -arch x86_64 -fPIC -O3 -funroll-loops
Fortran f90 compiler: /usr/local/bin/gfortran -Wall -g -fno-second-underscore -arch x86_64 -fPIC -O3 -funroll-loops
Fortran fix compiler: /usr/local/bin/gfortran -Wall -g -ffixed-form -fno-second-underscore -Wall -g -fno-second-underscore -arch x86_64 -fPIC -O3 -funroll-loops[0m
[39mcompile options: '-I/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9 -I/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include -I/Users/flavioc/miniconda3/include/python3.9 -c'
extra options: '-J/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/ -I/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/'[0m
[39mgfortran:f90: /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/rotacion_f-f2pywrappers2.f90[0m
[39m/usr/local/bin/gfortran -Wall -g -arch x86_64 -Wall -g -undefined dynamic_lookup -bundle /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/rotacion_fmodule.o /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/fortranobject.o /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/rotacion.o /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl/src.macosx-10.9-x86_64-3.9/rotacion_f-f2pywrappers2.o -L/usr/local/Cellar/gcc/10.2.0_4/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0_4/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0_4/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -lgfortran -o ./rotacion_f.cpython-39-darwin.so[0m
ld: warning: dylib (/usr/local/Cellar/gcc/10.2.0_4/lib/gcc/10/libgfortran.dylib) was built for newer macOS version (11.2) than being linked (10.9)
ld: warning: dylib (/usr/local/Cellar/gcc/10.2.0_4/lib/gcc/10/libquadmath.dylib) was built for newer macOS version (11.2) than being linked (10.9)
Removing build directory /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmp8h2z4zyl</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rotacion_f</span> <span class="kn">import</span> <span class="n">rotaciones</span> <span class="k">as</span> <span class="n">rotf</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yf</span> <span class="o">=</span> <span class="n">rotf</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">yf</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span> <span class="mf">4.22770593e-01</span>  <span class="mf">3.33318934e-01</span> <span class="o">-</span><span class="mf">5.49571740e-04</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">6.05335674e-01</span>  <span class="mf">4.34396149e-01</span>  <span class="mf">6.87862512e-01</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">9.84128217e-01</span>  <span class="mf">4.35323746e-01</span> <span class="o">-</span><span class="mf">1.62964229e-01</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">3.17757248e-01</span>  <span class="mf">4.72584037e-01</span>  <span class="mf">3.75531685e-01</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">7.35722302e-01</span>  <span class="mf">1.58547744e-01</span>  <span class="mf">6.73141163e-01</span><span class="p">]]</span>
<span class="p">[[</span> <span class="mf">4.22770593e-01</span>  <span class="mf">3.33318934e-01</span> <span class="o">-</span><span class="mf">5.49571740e-04</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">6.05335674e-01</span>  <span class="mf">4.34396149e-01</span>  <span class="mf">6.87862512e-01</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">9.84128217e-01</span>  <span class="mf">4.35323746e-01</span> <span class="o">-</span><span class="mf">1.62964229e-01</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">3.17757248e-01</span>  <span class="mf">4.72584037e-01</span>  <span class="mf">3.75531685e-01</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">7.35722302e-01</span>  <span class="mf">1.58547744e-01</span>  <span class="mf">6.73141163e-01</span><span class="p">]]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">yf</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span>
</pre></div>
</div>
<p>Veamos qué es exactamente lo que importamos:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">rotf</span><span class="o">.</span><span class="n">rotate</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">y = rotate(angles,v,[n])

Wrapper for <code class="docutils literal notranslate"><span class="pre">rotate</span></code>.

Parameters
----------
angles : input rank-1 array('d') with bounds (3)
v : input rank-2 array('d') with bounds (3,n)

Other Parameters
----------------
n : input int, optional
    Default: shape(v,1)

Returns
-------
y : rank-2 array('d') with bounds (3,n) and rotate storage</pre>
<p>Como vemos, estamos usando la función <code class="docutils literal notranslate"><span class="pre">rotate</span></code> definida en Fortran.
Notar que: * Tiene tres argumentos. * Dos argumentos requeridos:
<code class="docutils literal notranslate"><span class="pre">angles</span></code> y <code class="docutils literal notranslate"><span class="pre">v</span></code> * Un argumento, correspondiente a la dimensión <code class="docutils literal notranslate"><span class="pre">n</span></code>
que F2PY automáticamente detecta como opcional.</p>
</div>
<div class="section" id="segundo-ejemplo-codigo-heredado">
<<<<<<< HEAD
<h4>Segundo Ejemplo: Código heredado<a class="headerlink" href="#segundo-ejemplo-codigo-heredado" title="Enlazar permanentemente con este título"></a></h4>
=======
<h4>Segundo Ejemplo: Código heredado<a class="headerlink" href="#segundo-ejemplo-codigo-heredado" title="Enlazar permanentemente con este título">¶</a></h4>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<p>La conversión que realizamos con f2py3 la podríamos haber realizado en
dos pasos:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ f2py3 rotacion.f90 -m rotacion_f -h rotacion.pyf
$ f2py3 -c rotacion.pyf -m rotacion_f
</pre></div>
</div>
<p>En el primer paso se crea un archivo <em>signature</em> que después se utiliza
para crear el módulo que llamaremos desde <strong>Python</strong>. Haciéndolo en dos
pasos nos permite modificar el texto del archivo <em>.pyf</em> antes de
ejecutar el segundo comando.</p>
<p>Esto es útil cuando el código original no es lo suficientemente
“moderno”, no tiene toda la información necesaria sobre los argumentos o
es un código que uno no quiere o puede editar. Veamos que forma tienen
con un ejemplo más simple (tomado de la <a class="reference external" href="https://docs.scipy.org/doc/numpy-dev/f2py/getting-started.html">guía de
usuario</a>):</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span>      <span class="k">SUBROUTINE </span><span class="n">FIB</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">C</span>
<span class="n">C</span>     <span class="n">CALCULATE</span> <span class="n">FIRST</span> <span class="n">N</span> <span class="n">FIBONACCI</span> <span class="n">NUMBERS</span>
<span class="n">C</span>
      <span class="kt">INTEGER </span><span class="n">N</span>
      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
         <span class="k">IF</span> <span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0D0</span>
         <span class="n">ELSEIF</span> <span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0D0</span>
         <span class="k">ELSE</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<<<<<<< HEAD
         <span class="k">ENDIF</span>
<span class="k">      ENDDO</span>
<span class="k">      END</span>
=======
         <span class="n">ENDIF</span>
      <span class="n">ENDDO</span>
      <span class="k">END</span>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!f2py3 --overwrite-signature fib1.f -m fib1 -h fib1.pyf
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Reading</span> <span class="n">fortran</span> <span class="n">codes</span><span class="o">...</span>
    <span class="n">Reading</span> <span class="n">file</span> <span class="s1">&#39;fib1.f&#39;</span> <span class="p">(</span><span class="nb">format</span><span class="p">:</span><span class="n">fix</span><span class="p">,</span><span class="n">strict</span><span class="p">)</span>
<span class="n">Post</span><span class="o">-</span><span class="n">processing</span><span class="o">...</span>
    <span class="n">Block</span><span class="p">:</span> <span class="n">fib1</span>
                    <span class="n">Block</span><span class="p">:</span> <span class="n">fib</span>
<span class="n">Post</span><span class="o">-</span><span class="n">processing</span> <span class="p">(</span><span class="n">stage</span> <span class="mi">2</span><span class="p">)</span><span class="o">...</span>
<span class="n">Saving</span> <span class="n">signatures</span> <span class="n">to</span> <span class="n">file</span> <span class="s2">&quot;./fib1.pyf&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!cat fib1.pyf
</pre></div>
</div>
<pre class="literal-block">!    -<em>- f90 -</em>-
! Note: the context of this file is case sensitive.

python module fib1 ! in
    interface  ! in :fib1
        subroutine fib(a,n) ! in :fib1:fib1.f
            real*8 dimension(n) :: a
            integer, optional,check(len(a)&gt;=n),depend(a) :: n=len(a)
        end subroutine fib
    end interface
end python module fib1

! This file was auto-generated with f2py (version:1.21.2).
! See http://cens.ioc.ee/projects/f2py2e/</pre>
<p>El contenido del archivo <code class="docutils literal notranslate"><span class="pre">fib1.pyf</span></code> es:</p>
<div class="highlight-f90 notranslate"><div class="highlight"><pre><span></span>python module fib1 ! in
    interface  ! in :fib1
        subroutine fib(a,n) ! in :fib1:fib1.f
            real*8 dimension(n) :: a
            integer, optional,check(len(a)&gt;=n),depend(a) :: n=len(a)
        end subroutine fib
    end interface
end python module fib1
</pre></div>
</div>
<p>Este código indica que tenemos una subrutina que toma dos argumentos: -
<code class="docutils literal notranslate"><span class="pre">a</span></code> es un array - <code class="docutils literal notranslate"><span class="pre">n</span></code> es un entero opcional, que tiene que ser mayor
que <code class="docutils literal notranslate"><span class="pre">len(a)</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!f2py3  -c fib1.pyf fib1.f &gt; /dev/null
</pre></div>
</div>
<pre class="literal-block">In file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmphlprsqk7/src.macosx-10.9-x86_64-3.9/fib1module.c:16:
In file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmphlprsqk7/src.macosx-10.9-x86_64-3.9/fortranobject.h:13:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/arrayobject.h:4:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarrayobject.h:12:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarraytypes.h:1969:
[1m/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2: [0m[0;1;35mwarning: [0m[1m&quot;Using deprecated NumPy API, disable it with &quot;          &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [-W#warnings][0m
#warning &quot;Using deprecated NumPy API, disable it with &quot; [0;1;32m ^
[0mIn file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmphlprsqk7/src.macosx-10.9-x86_64-3.9/fortranobject.c:2:
In file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmphlprsqk7/src.macosx-10.9-x86_64-3.9/fortranobject.h:13:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/arrayobject.h:4:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarrayobject.h:12:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarraytypes.h:1969:
[1m/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2: [0m[0;1;35mwarning: [0m[1m&quot;Using deprecated NumPy API, disable it with &quot;          &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [-W#warnings][0m
#warning &quot;Using deprecated NumPy API, disable it with &quot; [0;1;32m ^
[0m[1m/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmphlprsqk7/src.macosx-10.9-x86_64-3.9/fib1module.c:109:12: [0m[0;1;35mwarning: [0m[1munused function 'f2py_size' [-Wunused-function][0m
static int f2py_size(PyArrayObject* var, ...)
[0;1;32m           ^
[0m2 warnings generated.
1 warning generated.
ld: warning: dylib (/usr/local/Cellar/gcc/10.2.0_4/lib/gcc/10/libgfortran.dylib) was built for newer macOS version (11.2) than being linked (10.9)
ld: warning: dylib (/usr/local/Cellar/gcc/10.2.0_4/lib/gcc/10/libquadmath.dylib) was built for newer macOS version (11.2) than being linked (10.9)</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[31mfib1.cpython-39-darwin.so[m[m*       [1m[36mfib3.cpython-39-darwin.so.dSYM[m[m/
fib1.f                           fib3.f
fib1.pyf                         rotacion.f90
[31mfib2.cpython-39-darwin.so[m[m*       rotacion.pyf
[1m[36mfib2.cpython-39-darwin.so.dSYM[m[m/  [31mrotacion_f.cpython-39-darwin.so[m[m*
fib2.pyf                         rotaciones.mod
[31mfib3.cpython-39-darwin.so[m[m*
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fib1</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">fib(a,[n])

Wrapper for <code class="docutils literal notranslate"><span class="pre">fib</span></code>.

Parameters
----------
a : input rank-1 array('d') with bounds (n)

Other Parameters
----------------
n : input int, optional
    Default: len(a)</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mf">0.</span>  <span class="mf">1.</span>  <span class="mf">1.</span>  <span class="mf">2.</span>  <span class="mf">3.</span>  <span class="mf">5.</span>  <span class="mf">8.</span> <span class="mf">13.</span> <span class="mf">21.</span> <span class="mf">34.</span> <span class="mf">55.</span> <span class="mf">89.</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mf">0.</span>  <span class="mf">1.</span>  <span class="mf">1.</span>  <span class="mf">2.</span>  <span class="mf">3.</span>  <span class="mf">5.</span>  <span class="mf">8.</span> <span class="mf">13.</span>  <span class="mf">0.</span>  <span class="mf">0.</span>  <span class="mf">0.</span>  <span class="mf">0.</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>

<span class="n">error</span>                                     <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>

<span class="n">Input</span> <span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">cell</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2</span><span class="o">&gt;</span><span class="p">()</span>
      <span class="mi">1</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="o">----&gt;</span> <span class="mi">2</span> <span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>
      <span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>


<span class="n">error</span><span class="p">:</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">n</span><span class="p">)</span> <span class="n">failed</span> <span class="k">for</span> <span class="mi">1</span><span class="n">st</span> <span class="n">keyword</span> <span class="n">n</span><span class="p">:</span> <span class="n">fib</span><span class="p">:</span><span class="n">n</span><span class="o">=</span><span class="mi">18</span>
</pre></div>
</div>
<p>Esta es una de las características de F2PY: hace un chequeo básico de
los argumentos. Hay otro error que no llega a atrapar: Si le pasamos un
array que no es del tipo indicado, falla (sin avisar). Éste claramente
no es el comportamiento deseado:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Vamos a modificar el archivo de <em>signature</em> para enseñarle dos cosas:</p>
<ul class="simple">
<li><p>El entero es un argumento de entrada (requerido)</p></li>
<li><p>El <em>array</em> <code class="docutils literal notranslate"><span class="pre">a</span></code> es un archivo de salida <strong>exclusivamente</strong>. Entonces
no debemos dárselo. La parte <code class="docutils literal notranslate"><span class="pre">dimension(n)</span></code> y <code class="docutils literal notranslate"><span class="pre">depend(n)</span></code> indica
que debe crear un vector de ese tamaño.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!cat fib1.pyf
</pre></div>
</div>
<pre class="literal-block">!    -<em>- f90 -</em>-
! Note: the context of this file is case sensitive.

python module fib1 ! in
    interface  ! in :fib1
        subroutine fib(a,n) ! in :fib1:fib1.f
            real*8 dimension(n) :: a
            integer, optional,check(len(a)&gt;=n),depend(a) :: n=len(a)
        end subroutine fib
    end interface
end python module fib1

! This file was auto-generated with f2py (version:1.21.2).
! See http://cens.ioc.ee/projects/f2py2e/</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!cat fib2.pyf
</pre></div>
</div>
<pre class="literal-block">!    -<em>- f90 -</em>-
! Note: the context of this file is case sensitive.

python module fib2
    interface
        subroutine fib(a,n)
            real*8 dimension(n), intent(out), depend(n) :: a
            integer intent(in) :: n
        end subroutine fib
    end interface
end python module fib2

! This file was auto-generated with f2py (version:1.21.2).
! See http://cens.ioc.ee/projects/f2py2e/</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!f2py3  -c fib2.pyf fib1.f &gt; /dev/null
</pre></div>
</div>
<pre class="literal-block">In file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmpbx5qc9hg/src.macosx-10.9-x86_64-3.9/fortranobject.c:2:
In file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmpbx5qc9hg/src.macosx-10.9-x86_64-3.9/fortranobject.h:13:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/arrayobject.h:4:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarrayobject.h:12:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarraytypes.h:1969:
[1m/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2: [0m[0;1;35mwarning: [0m[1m&quot;Using deprecated NumPy API, disable it with &quot;          &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [-W#warnings][0m
#warning &quot;Using deprecated NumPy API, disable it with &quot; [0;1;32m ^
[0mIn file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmpbx5qc9hg/src.macosx-10.9-x86_64-3.9/fib2module.c:16:
In file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmpbx5qc9hg/src.macosx-10.9-x86_64-3.9/fortranobject.h:13:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/arrayobject.h:4:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarrayobject.h:12:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarraytypes.h:1969:
[1m/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2: [0m[0;1;35mwarning: [0m[1m&quot;Using deprecated NumPy API, disable it with &quot;          &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [-W#warnings][0m
#warning &quot;Using deprecated NumPy API, disable it with &quot; [0;1;32m ^
[0m[1m/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmpbx5qc9hg/src.macosx-10.9-x86_64-3.9/fib2module.c:102:12: [0m[0;1;35mwarning: [0m[1munused function 'f2py_size' [-Wunused-function][0m
static int f2py_size(PyArrayObject* var, ...)
[0;1;32m           ^
[0m2 warnings generated.
1 warning generated.
ld: warning: dylib (/usr/local/Cellar/gcc/10.2.0_4/lib/gcc/10/libgfortran.dylib) was built for newer macOS version (11.2) than being linked (10.9)
ld: warning: dylib (/usr/local/Cellar/gcc/10.2.0_4/lib/gcc/10/libquadmath.dylib) was built for newer macOS version (11.2) than being linked (10.9)</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fib2</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fib2</span><span class="o">.</span><span class="n">fib</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">a = fib(n)

Wrapper for <code class="docutils literal notranslate"><span class="pre">fib</span></code>.

Parameters
----------
n : input int

Returns
-------
a : rank-1 array('d') with bounds (n)</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fib2</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">2.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">,</span>  <span class="mf">5.</span><span class="p">,</span>  <span class="mf">8.</span><span class="p">,</span> <span class="mf">13.</span><span class="p">,</span> <span class="mf">21.</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fib2</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>  <span class="mf">0.</span>   <span class="mf">1.</span>   <span class="mf">1.</span>   <span class="mf">2.</span>   <span class="mf">3.</span>   <span class="mf">5.</span>   <span class="mf">8.</span>  <span class="mf">13.</span>  <span class="mf">21.</span>  <span class="mf">34.</span>  <span class="mf">55.</span>  <span class="mf">89.</span> <span class="mf">144.</span> <span class="mf">233.</span><span class="p">]</span>
</pre></div>
</div>
<p>La segunda manera de arreglar este problema, en lugar de modificar el
archivo de <em>signature</em> podría haber sido modificar el código (o hacer
una rutina intermedia). Agregando comentarios de la forma <code class="docutils literal notranslate"><span class="pre">Cf2py</span></code> no
influimos en la compilación <code class="docutils literal notranslate"><span class="pre">Fortran</span></code> pero F2PY los reconoce. En este
caso le damos la información sobre la intención de los argumentos en el
código:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span>      <span class="k">SUBROUTINE </span><span class="n">FIB</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">C</span>
<span class="n">C</span>     <span class="n">CALCULATE</span> <span class="n">FIRST</span> <span class="n">N</span> <span class="n">FIBONACCI</span> <span class="n">NUMBERS</span>
<span class="n">C</span>
      <span class="kt">INTEGER </span><span class="n">N</span>
      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">Cf2py</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="n">n</span>
<span class="n">Cf2py</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="n">a</span>
<span class="n">Cf2py</span> <span class="n">depend</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="n">a</span>
      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
         <span class="k">IF</span> <span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0D0</span>
         <span class="n">ELSEIF</span> <span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0D0</span>
         <span class="k">ELSE</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<<<<<<< HEAD
         <span class="k">ENDIF</span>
<span class="k">      ENDDO</span>
<span class="k">      END</span>
=======
         <span class="n">ENDIF</span>
      <span class="n">ENDDO</span>
      <span class="k">END</span>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!f2py3  -c fib3.f -m fib3 &gt; /dev/null
</pre></div>
</div>
<pre class="literal-block">In file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmpkg02pumo/src.macosx-10.9-x86_64-3.9/fib3module.c:16:
In file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmpkg02pumo/src.macosx-10.9-x86_64-3.9/fortranobject.h:13:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/arrayobject.h:4:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarrayobject.h:12:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarraytypes.h:1969:
[1m/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2: [0m[0;1;35mwarning: [0m[1m&quot;Using deprecated NumPy API, disable it with &quot;          &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [-W#warnings][0m
#warning &quot;Using deprecated NumPy API, disable it with &quot; [0;1;32m ^
[0mIn file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmpkg02pumo/src.macosx-10.9-x86_64-3.9/fortranobject.c:2:
In file included from /var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmpkg02pumo/src.macosx-10.9-x86_64-3.9/fortranobject.h:13:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/arrayobject.h:4:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarrayobject.h:12:
In file included from /Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/ndarraytypes.h:1969:
[1m/Users/flavioc/miniconda3/lib/python3.9/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2: [0m[0;1;35mwarning: [0m[1m&quot;Using deprecated NumPy API, disable it with &quot;          &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [-W#warnings][0m
#warning &quot;Using deprecated NumPy API, disable it with &quot; [0;1;32m ^
[0m[1m/var/folders/18/8wj5kxln1dzbpqvfs_35mz000000gn/T/tmpkg02pumo/src.macosx-10.9-x86_64-3.9/fib3module.c:102:12: [0m[0;1;35mwarning: [0m[1munused function 'f2py_size' [-Wunused-function][0m
static int f2py_size(PyArrayObject* var, ...)
[0;1;32m           ^
[0m2 warnings generated.
1 warning generated.
ld: warning: dylib (/usr/local/Cellar/gcc/10.2.0_4/lib/gcc/10/libgfortran.dylib) was built for newer macOS version (11.2) than being linked (10.9)
ld: warning: dylib (/usr/local/Cellar/gcc/10.2.0_4/lib/gcc/10/libquadmath.dylib) was built for newer macOS version (11.2) than being linked (10.9)</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fib3</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fib3</span><span class="o">.</span><span class="n">fib</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">a = fib(n)

Wrapper for <code class="docutils literal notranslate"><span class="pre">fib</span></code>.

Parameters
----------
n : input int

Returns
-------
a : rank-1 array('d') with bounds (n)</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fib2</span><span class="o">.</span><span class="n">fib</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">a = fib(n)

Wrapper for <code class="docutils literal notranslate"><span class="pre">fib</span></code>.

Parameters
----------
n : input int

Returns
-------
a : rank-1 array('d') with bounds (n)</pre>
<p>como vemos, son exactamente iguales.</p>
</div>
<div class="section" id="f2py-para-codigo-en-c">
<<<<<<< HEAD
<h4>F2PY para código en C<a class="headerlink" href="#f2py-para-codigo-en-c" title="Enlazar permanentemente con este título"></a></h4>
=======
<h4>F2PY para código en C<a class="headerlink" href="#f2py-para-codigo-en-c" title="Enlazar permanentemente con este título">¶</a></h4>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
<p>Es posible usar F2PY para código escrito en C, pero en ese caso debemos
escribir el <em>signature file</em> a mano.</p>
<p>Para código en C es conveniente utilizar <strong>Cython</strong>. Cython es un
lenguaje de programación pensado para hacer más fácil escribir
extensiones a Python en C. Uno escribe el código en Cython, y luego es
traducido a C, con optimizaciones.</p>
<p><strong>Cython</strong> también puede utilizarse con Fortran de una manera similar a
cómo se usa con C. Para más información ver la <a class="reference external" href="http://docs.cython.org/en/latest/index.html">documentación
oficial</a></p>
</div>
</div>
</div>
</div>


           </div>
<<<<<<< HEAD
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="clase_14.html" class="btn btn-neutral float-left" title="Clase 14: Animaciones e interactividad" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="ejercicios.html" class="btn btn-neutral float-right" title="Ejercicios" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
=======
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="ejercicios.html" class="btn btn-neutral float-right" title="Ejercicios" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="clase_14.html" class="btn btn-neutral float-left" title="Clase 14: Animaciones e interactividad" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd
    </div>

  <hr/>

  <div role="contentinfo">
<<<<<<< HEAD
    <p>&#169; Derechos de autor IB - 2022, Juan Fiol.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   
=======
    <p>
        &#169; Derechos de autor IB - 2022, Juan Fiol.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd

</footer>
        </div>
      </div>
<<<<<<< HEAD
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
=======

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
>>>>>>> 1fad8f3f65bbcee2af442c61dc8ec20bee6f09dd

</body>
</html>